# 一文彻底看懂HTTPS

我们经常使用这个协议，那么他究竟是什么？这一切还得从它的老大哥——HTTP讲起。

我们知道http协议是一个应用层协议，使用非常宽泛，那么为啥还需要HTTPS呢？

因为http是使用**明文传输**的，明文传输？那加个密钥不就行了？

答案是不行，使用对称加密的过程如下所示

[![](https://pic.imgdb.cn/item/60ab6185ce272128a6e46533.jpg)](https://pic.imgdb.cn/item/60ab6185ce272128a6e46533.jpg)

只需要两步，简简单单，但是如果在第一步的时候被人监听了，拿到了你的密钥，那不就完了吗

因此引出了我们的主人公——**非对称加密**

#### 非对称加密

简单说就是有两把密钥，通常一把叫做公钥、一把叫私钥，用公钥加密的内容必须用私钥才能解开，同样，私钥加密的内容只有公钥能解开。

ok，有了这个我们就可以做很多事了，继续看图

[![](https://pic.imgdb.cn/item/60ab62f1ce272128a6f0cb61.jpg)](https://pic.imgdb.cn/item/60ab62f1ce272128a6f0cb61.jpg)

乍一看，没问题了，但是如果攻击者不是简单的监听，而是会篡改一些东西，这个协议还扛得住吗

[![](https://pic.imgdb.cn/item/60ab6450ce272128a6fbd568.jpg)](https://pic.imgdb.cn/item/60ab6450ce272128a6fbd568.jpg)

看来还是不行呀，那该怎么办呢？

我们分析问题，发现问题出在浏览器无法判断来自服务器的公钥是否被别人篡改过，我们可以添加一个数字证书来解决。

#### 数字证书

既然我们的浏览器要辨别来自服务器的信息是否被篡改过，我们就不能听信服务器的“一面之词”，我们需要有第三方的权威机构来介入，这就是**CA机构**

我们的服务器可以向CA机构申请一个数字证书，

最简单的证书包含一个公开密钥、名称以及证书授权中心的数字签名。数字证书还有一个重要的特征就是只在特定的时间段内有效。

这个公开密钥就是服务器的公钥，当然也是加过密的。具体的流程为

[![](https://pic.imgdb.cn/item/60ab68bace272128a6208aaa.jpg)](https://pic.imgdb.cn/item/60ab68bace272128a6208aaa.jpg)

讲完数字证书，我们再回过头来看看我们的HTTPS

[![](https://pic.imgdb.cn/item/60ab6b2cce272128a6328de7.jpg)](https://pic.imgdb.cn/item/60ab6b2cce272128a6328de7.jpg)

那么这个方案完美了吗？

我们来看看证书会被篡改吗？

答：不会，因为没有CA私钥

那么证书会被掉包吗？

答：不会，因为解析出来的域名与浏览器想要访问的域名不同

为什么不直接使用非对称加密呢？

答：速度慢

CA公钥会不会被伪造？

答：不会，CA公钥在操作系统或者是浏览器中存放，都是预先就写好的

