# B树/B+树/B*树

1. ### B树

   这节课本应该是讲第二种二叉搜索树——红黑树的，但是在学红黑树之前我们应该先学习一下B树，为什么的话学过就知道了。

   一棵m阶B树(balanced tree of order m)是一棵平衡的m路搜索树。它或者是空树，或者是满足下列性质的树：

   1、根结点至少有两个子女；

   2、每个非根节点所包含的关键字个数 j 满足：┌m/2┐ - 1 <= j <= m - 1；

   3、除根结点以外的所有结点（不包括叶子结点）的度数正好是关键字总数加1，故内部子树个数 k 满足：┌m/2┐ <= k <= m ；

   4、所有的叶子结点都位于同一层。

   例如下列为一棵4阶B树

   ![](https://img.imgdb.cn/item/5ffaec013ffa7d37b3751963.png)

   #### 插入操作：

   如果要插入56的话，很明显可以直接插入。

   如果要插入98的话，90 95 98 100 4个数很明显超出了4阶B树的限制，这种情况叫做上溢。

   如果向上合并后上面又发生了上溢，那就继续上溢。

   ![](https://img.imgdb.cn/item/5ffaecdf3ffa7d37b375b7d5.png)

   

   ### 删除操作：

   如果要删除的是叶子节点，就直接删除。

   如果其兄弟节点的节点个数大于┌m/2┐ - 1那么就向其兄弟“借”一个

   ![](https://img.imgdb.cn/item/5ffaf0203ffa7d37b377cb17.png)

   如果其兄弟节点也穷的不行（节点个数等于┌m/2┐ - 1）就合并。

   ![](https://img.imgdb.cn/item/5ffaf0203ffa7d37b377cb1c.png)

   

   看完B树的基本操作，那和我们的红黑树有什么关联呢

   大家可以尝试一下4阶B树。

2. ### B+树

   ![](https://pic.imgdb.cn/item/602e6a05e7e43a13c6fd1d7b.png)

   B+树是一种树数据结构，通常用于**数据库和操作系统的文件系统**中。B+树的特点是能够保持数据稳定有序，其插入与修改拥有较稳定的**对数时间复杂度**。B+树元素**自底向上插入**，这与二叉树恰好相反。 

   - ##### B+树是B树的一种变形形式，B+树上的叶子结点存储关键字以及相应记录的地址，叶子结点以上各层作为索引使用。一棵m阶的B+树定义如下: 

     (1)每个结点至多有m个子女；

     (2)除根结点外，每个结点至少有[m/2]个子女，根结点至少有两个子女；

     (3)有k个子女的结点必有k个关键字。 

     B+树的查找与B树不同，当索引部分某个结点的关键字与所查的关键字相等时，并不停止查找，应继续沿着这个关键字左边的指针向下，一直查到该关键字所在的叶子结点为止。

   - ##### 查找

     查找以典型的方式进行，类似于二叉查找树。起始于根节点，自顶向下遍历树，选择其分离值在要查找值的任意一边的子指针。在节点内部典型的使用是二分查找来确定这个位置。

   - ##### 插入

     节点要处于违规状态，它必须包含在可接受范围之外数目的元素。

     1. 首先，查找要插入其中的节点的位置。接着把值插入这个节点中。
     2. 如果没有节点处于违规状态则处理结束。
     3. 如果某个节点有过多元素，则把它分裂为两个节点，每个都有最小数目的元素。在树上递归向上继续这个处理直到到达根节点，如果根节点被分裂，则创建一个新根节点。为了使它工作，元素的最小和最大数目典型的必须选择为使最小数不小于最大数的一半。

   - ##### 删除

     1. 首先，查找要删除的值。接着从包含它的节点中删除这个值。

     2. 如果没有节点处于违规状态则处理结束。

     3. 如果节点处于违规状态则有两种可能情况：

     4. 1. 它的兄弟节点，就是同一个父节点的子节点，可以把一个或多个它的子节点转移到当前节点，而把它返回为合法状态。如果是这样，在更改父节点和两个兄弟节点的分离值之后处理结束。
        2. 它的兄弟节点由于处在低边界上而没有额外的子节点。在这种情况下把两个兄弟节点合并到一个单一的节点中，而且我们递归到父节点上，因为它被删除了一个子节点。持续这个处理直到当前节点是合法状态或者到达根节点，在其上根节点的子节点被合并而且合并后的节点成为新的根节点。

   - **特点**

   ​		1、B+**树的层级更少**：相较于B树B+每个**非叶子**节点存储的关键字数更多，树的层级更少所以查询数据更		快；

   ​		2、B+**树查询速度更稳定**：B+所有关键字数据地址都存在**叶子**节点上，所以每次查找的次数都相同所以查		询速度要比B树更稳定;

   ​		3、B+**树天然具备排序功能：**B+树所有的**叶子**节点数据构成了一个有序链表，在查询大小区间的数据时候		更方便，数据紧密性很高，缓存的命中率也会比B树高。

   ​		4、B+**树全节点遍历更快：**B+树遍历整棵树只需要遍历所有的**叶子**节点即可，，而不需要像B树一样需要		对每一层进行遍历，这有利于数据库做全表扫描。

   

   ​		**B树相对于B+树的优点是，如果经常访问的数据离根节点很近，而B树的非叶子节点本身存有关键字其		数据的地址，所以这种数据检索的时候会要比B+树快。**

   

3. ### B*树

   ![](https://pic.imgdb.cn/item/602e6b9ee7e43a13c6fddb2a.png)

    **是B+树的变体，在B+树的非根和非叶子结点再增加指向兄弟的指针；**

    B*树定义了非叶子结点关键字个数至少为(2/3)*M，即块的最低使用率为2/3

   （代替B+树的1/2）；

   ​    B+树的分裂：当一个结点满时，分配一个新的结点，并将原结点中1/2的数据

   复制到新结点，最后在父结点中增加新结点的指针；B+树的分裂只影响原结点和父

   结点，而不会影响兄弟结点，所以它不需要指向兄弟的指针；

   ​    B*树的分裂：当一个结点满时，如果它的下一个兄弟结点未满，那么将一部分

   数据移到兄弟结点中，再在原结点插入关键字，最后修改父结点中兄弟结点的关键字

   （因为兄弟结点的关键字范围改变了）；如果兄弟也满了，则在原结点与兄弟结点之

   间增加新结点，并各复制1/3的数据到新结点，最后在父结点增加新结点的指针；

   ​    所以，B*树分配新结点的概率比B+树要低，空间使用率更高；

4. ### 小结:

   1.  二叉搜索树：二叉树，每个结点只存储一个关键字，等于则命中，小于走左结点，大于

      走右结点；

   2.  B（B-）树：多路搜索树，每个结点存储M/2到M个关键字，非叶子结点存储指向关键

      字范围的子结点；

       所有关键字在整颗树中出现，且只出现一次，非叶子结点可以命中；

   3. B+树：在B-树基础上，为叶子结点增加链表指针，所有关键字都在叶子结点

      中出现，非叶子结点作为叶子结点的索引；B+树总是到叶子结点才命中；

   4.   B*树：在B+树基础上，为非叶子结点也增加链表指针，将结点的最低利用率

      从1/2提高到2/3；

