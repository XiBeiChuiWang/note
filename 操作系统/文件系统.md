## 文件系统

1. ### 文件的逻辑结构

   1. #### 有结构文件

      1. ##### 顺序文件

         1. ###### 链式存储

            **不能实现随机存储**

         2. ###### 顺序存储

            1. **可变长**

               **不能实现随机存储**

            2. **不可变长**

               **可实现随机存储**

      2. ##### 索引文件

          **索引表本身是定长记录的顺序文件。因此可以快速找到第 i 个记录对应的索引项。** 

         ![](https://pic.downk.cc/item/5fe83e903ffa7d37b3c1bdd1.png) 

      3. ##### 索引顺序文件

         **索引顺序文件是索引文件和顺序文件思想的 结合。索引顺序文件中，同样会为文件建立 一张索引表，但不同的是：并不是每个记录 对应一个索引表项，而是一组记录对应一个 索引表项。** 

         ![](https://pic.downk.cc/item/5fe83e903ffa7d37b3c1bdd5.png)

         ######  多级索引顺序文件 

          **为了进一步提高检索效率，可以为顺序文件建立多级索引表。** 

         ![](https://pic.downk.cc/item/5fe83ef03ffa7d37b3c1e948.png)

   2. #### 无结构文件

      **流式文件**

2. ### 文件目录

   - ####  文件控制块

     ![](https://pic.downk.cc/item/5fe83f6d3ffa7d37b3c229ac.png)

   - ####  目录结构

     1. #####  单级目录结构 

     2. #####  两级目录结构 

     3. #####  多级目录结构 

         **又称树形目录结构** 

     4. #####  无环图目录结构 

   - ####  索引结点 

     ![](https://pic.downk.cc/item/5fe840713ffa7d37b3c2a6e7.png)

3. ### 文件物理结构

   1. #### 非空闲

      1. ##### 连续分配

         **可以直接算出逻辑块号对应的物理块号，因此连续分配支持顺序访问 和直接访问（即随机访问）** 

      2. ##### 链接分配

         1. ######  隐式链接 

            **除文件的最后一个盘块之外，每个盘块中都存有指向下一个盘块的指针。文件目录 包括文件第一块的指针和最后一块的指针。** 

            **优点：很方便文件拓展，不会有碎片问题，外存利用率高。** 

            **缺点：只支持顺序访问，不支持随机访问，查找效率低，指向下一个盘块的指针也需要耗费少量 的存储空间。** 

         2. ######  显式链接

            **把用于链接文件各物理块的指针显式地存放在一张表中，即 文件分配表（FAT，File Allocation Table）。一个磁盘只会建立一张文件分配表。开机时文件分配表放入内存，并常驻内 存。** 

            **优点：很方便文件拓展，不会有碎片问题，外存利用率高，并且支持随机访问。相比于隐式链接 来说，地址转换时不需要访问磁盘，因此文件的访问效率更高。** 

            **缺点：文件分配表的需要占用一定的存储空间。**  

      3. ##### 索引分配

         **索引分配允许文件离散地分配在各个磁盘块中，系统会为每个文件建立一张索引表，索引表中记录了文件的各个逻辑块对应的物理块（索引表的功能类似于内存管理中的页表——建立逻辑页面到物理页之间 的映射关系）。索引表存放的磁盘块称为索引块。文件数据存放的磁盘块称为数据块。** 

         ![](https://pic.downk.cc/item/5fe888d03ffa7d37b3e65b32.png)

         **索引分配方式可以支持随机访问。** 

         - ###### 索引表太大时

           1.  **链接方案**： 

              如果索引表太大，一个索引块装不下，那么可以将多个索引块链接起来存放。缺点：若文 件很大，索引表很长，就需要将很多个索引块链接起来。想要找到 i 号索引块，必须先依次读入 0~i-1 号索引块，这就导致磁盘I/O次数过多，查找效率低下。 

           2. **多层索引**： 

              建立多层索引（原理类似于多级页表）。使第一层索引块指向第二层的索引块。还可根据 文件大小的要求再建立第三层、第四层索引块。采用 K 层索引结构，且顶级索引表未调入内存，则访问 一个数据块只需要 K + 1 次读磁盘操作。缺点：即使是小文件，访问一个数据块依然需要K+1次读磁盘。 

              ![](https://pic.downk.cc/item/5fe888953ffa7d37b3e64011.png)
         
           3.  **混合索引**： 
           
              多种索引分配方式的结合。例如，一个文件的顶级索引表中，既包含直接地址索引（直接 指向数据块），又包含一级间接索引（指向单层索引表）、还包含两级间接索引（指向两层索引表） 。 优点：对于小文件来说，访问一个数据块所需的读磁盘次数更少。 

   2. #### 空闲

      1. ##### 空闲表法

         **适用于连续分配方式**

      2. ##### 空闲链表法

      3. ##### 位视图法

      4. ##### 成组链接法

4. ### 文件共享

   1. #### 基于索引节点的共享方式（硬链接）
   
      ![](https://pic.downk.cc/item/5fe886c73ffa7d37b3e55972.png)
   
   2. #### 基于符号链的共享方式（软链接）
   
      ![](https://pic.downk.cc/item/5fe886c73ffa7d37b3e55974.png)
   
5. ### 文件保护

   1. ##### 口令保护

   2. ##### 加密保护

   3. ##### 访问保护

   

   ### 文件层次结构

   ![](https://pic.downk.cc/item/5fe8898a3ffa7d37b3e6b347.png)

   

   ![](https://pic.downk.cc/item/5fe889da3ffa7d37b3e6d8f5.png)



